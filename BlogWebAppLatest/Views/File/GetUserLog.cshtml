@using BlogWebApp.ViewModel
@model IEnumerable<BlogFileInfo>
@* @model BlogVM; *@
@{
    Layout = "_AdminLayout";
    ViewData["Title"] = "Blog Log";
}
<style>
    /*   .image-picker-div {
            display: none;
        } */
</style>

<section class="section">
    <div class="row justify-content-center">
        <div class="col-lg-12">
        <div class="card">
            <div class="card-body pb-1 pe-0">
                    <div class="col-auto row align-items-center justify-content-end pe-0">
                        <input type="text" id="SearchLog" placeholder="Search...." class="form-control col-4 mt-1" aria-describedby="SearchLog">
                    </div>
                     </div>
                  <div class="table-responsive" style="max-height: 60vh!important; overflow:scroll!important;">
                     <table class="table table-striped table-hover LogTable" >
                        <thead>
                            <tr>
                                <th>File Name</th>
                                <th>Blog Title</th>
                                <th>Date</th>
                                <th> Download</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var fileInfo in Model)
                            {
                                <tr>
                                    <td>@fileInfo.FileName</td>
                                    <td>@fileInfo.BlogTitle</td>
                                    <td>@fileInfo.Date</td>
                                        <td><a href="/BlogLogs/@fileInfo.Url" download> <i class="bi bi-arrow-down-circle-fill"></i></a></td>
                                </tr>
                            }
                        </tbody>
                    </table>
               
         </div>
        </div>
        </div>
    </div>
</section>

<link href="~/toastr/css/toastr.css" rel="stylesheet" />

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.2.8/js/fileinput.min.js"></script>

<script src="~/toastr/js/toastr.js"></script>

<script type="text/javascript">

    $(document).ready(function () {
        $("#SearchLog").on("input", function () {
            var searchText = $(this).val().toLowerCase(); // Get the value entered in the search input field
            var found = false; // Flag to track if any records match the search

            $(".LogTable tbody tr").each(function () { // Loop through each row in the table body
                var rowData = $(this).text().toLowerCase(); // Get the text content of the row in lowercase
                if (rowData.includes(searchText)) { // Check if the row contains the search text
                    $(this).show(); // Show the row if it matches the search
                    found = true; // Set the flag to true since a match is found
                } else {
                    $(this).hide(); // Hide the row if it doesn't match the search
                }
            });

            if (!found) { // If no records match the search
                // Remove any existing "No records found" row
                $("#noRecordRow").remove();
                // Append a new row with the "No records found" message
                $(".LogTable tbody").append("<tr id='noRecordRow'><td colspan='colCount'>No records match the search.</td></tr>");
            } else {
                // If records are found, remove the "No records found" row
                $("#noRecordRow").remove();
            }
        });

        async function SaveBlogLogFile(modeldata, category) {
            var model = {
                Title: modeldata.Title,
                Body: modeldata.Body,
                CategoryName: category,
                Action: "Blog Updated"
            }
            // SaveBlogFile
                await $.ajax({
                    url: '/File/SaveBlogFile',
                    type: 'POST',
                    data: model,
                    success: function (response) {
                        console.log("log Saved");
                    },
                    error: function (xhr, status, error) {
                        console.log("Error to Save log");
                    }
                });
           }

    });
           
</script>


